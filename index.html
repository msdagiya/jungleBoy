<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Jungle Boy Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.18.1/phaser.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Slabo+27px&display=swap" rel="stylesheet"> 
    <style type="text/css">
        body {
            margin: 0;
	        font-family: 'Slabo 27px', serif;
        }
    </style>
</head>
<body style="width:720px;margin:auto auto;">
    <div style="width:360px; float:left;padding:0px 40px; box-sizing:border-box;display:block;"> 
        <a href="https://github.com/msdagiya"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_left_red_aa0000.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
        <h1>Jungle Boy Game</h1>
        <p>Use right and left keys to jump the tarzan on the static and movings pads. Collect bananas and Jumps, avoid bird and Jump on birds to get extra jump</p>
    </div>

<script type="text/javascript">
var tarzan;
var background;
var cursors;
var fire;
var bananas;
var score = 0;
var scoreText;
var pads;
var moving_pads;
var bonus;
var path = new Array(200);
var forest;
var coin;
var jump;
var birds;
var loadingText;
var key_left;
var key_right;
var current_pad;
var particles;
var mini_tarzen;
var volume = 0;
var time=0;
var time_text;
var clock;
var time_sprite;
var game_over;

class Menu extends Phaser.Scene{
    createStartButton(x,y){
        var Button = this.add.image(x, y, 'Button').setScale(0.1);
        var self = this;

	Button
        .setInteractive({useHandCursor: true})
        .on('pointerover', () => {Button.setTexture('Button_hover').setScale(0.1);})
        .on('pointerout', () => {Button.setTexture('Button').setScale(0.1)})
        .on('pointerdown', () => { Button.setTexture('Button_down').setScale(0.1)})
        .on('pointerup', () => {
            this.scene.bringToTop('Play');
            this.scene.start('Play');
        });
        this.tweens
        .add({
            targets: Button,
            scale:0.1125,
            duration: 500,
            ease: 'Power2',
            repeat: -1,
            yoyo:true
        }, this);
    }   
}


class Start extends Menu{
    constructor(){
        super({ key:'Start', active:true});
    }

    preload(){
        this.DisplayLoadingMessege();
        this.LoadPath();
        this.LoadFont();
        this.LoadImages();
        this.LoadAudio();
    }

    LoadPath(){
        this.load.path = 'assets/';
    }

    LoadFont(){
        this.load.bitmapFont('myfont', 'font/font.png', 'font/font.fnt');
    }

    LoadAudio(){
        // Coin Audio Asset
        this.load.audio('Coin', '341695__projectsu012__coins-1.wav');

        // Jump Audio Asset
        this.load.audio('Jump', '350901__cabled-mess__jump-c-06.wav');

        // GameOver Asset
        this.load.audio('GameOver', '382310__myfox14__game-over-arcade.wav');

    }
 
    LoadImages(){
        // Title assets
        this.load.image('Logo', 'coollogo_com-3156672.png');

		
	    // Point assets
        this.load.image('Point', 'cooltext333863632753835.png');

        //Button assets
        this.load.image('Button', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/normal/play.png');
        this.load.image('Button_hover', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/hover/play.png');
        this.load.image('Button_down', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/click/play.png');

        //Time
        this.load.image('Time', 'craftpix-103151-island-game-gui/Island-game-gui/png/frames/time.png');

		// Volume button Assets
        this.load.image('ButtonVolume_hover', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/hover/volume.png');
        this.load.image('ButtonVolume_lock', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/lock/volume.png');
        this.load.image('ButtonVolume', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/normal/volume.png');
		this.load.image('ButtonVolume_click', 'craftpix-103151-island-game-gui/Island-game-gui/png/buttons/click/volume.png');

        //Bird Assets
        this.load.image('Bird_0', 'PNG/Frame-1.png');
        this.load.image('Bird_1', 'PNG/frame-2.png');
        this.load.image('Bird_2', 'PNG/frame-3.png');
        this.load.image('Bird_3', 'PNG/frame-4.png');

        //Score Assets
        this.load.image('Score','craftpix-103151-island-game-gui/Island-game-gui/png/images/3 stars.png');
        this.load.image('Score2','craftpix-103151-island-game-gui/Island-game-gui/png/images/2 stars.png');
        this.load.image('Score1','craftpix-103151-island-game-gui/Island-game-gui/png/images/1 stars.png');
        this.load.image('Score0','craftpix-103151-island-game-gui/Island-game-gui/png/images/0 stars.png');

	    // scrollbar
        this.load.image('ScrollBar','craftpix-103151-island-game-gui/Island-game-gui/png/images/horisontal skrolling map.png');
        
        // Banana assets

        this.load.image('Banana', 'craftpix-871511-free-jumping-up-game-items/PNG/Props/Prop_2.png');
        this.load.image('Cone', 'craftpix-871511-free-jumping-up-game-items/PNG/Props/Prop_3.png');
        this.load.image('Jump', 'craftpix-871511-free-jumping-up-game-items/PNG/Bonus_Items/Jump_Bonus_02.png');

        // Pad
        this.load.image('Pad', 'craftpix-871511-free-jumping-up-game-items/PNG/Pads/Pad_02_1.png');
        this.load.image('Sharp_Pad', 'craftpix-871511-free-jumping-up-game-items/PNG/Pads/Pad_02_2.png');

        //Falling Down assets
        this.load.image('Falling_Down', 'Jumping_boy_sprites_v102/Transparent PNG/Jump/Jump-fall.png');

        //Jump Up assets
        this.load.image('Jump_Up', 'Jumping_boy_sprites_v102/Transparent PNG/Jump/Jump-up.png');

        //Idle assets
        this.load.image('Idle_000', 'Jumping_boy_sprites_v102/Transparent PNG/Idle/frame-1.png');
        this.load.image('Idle_001', 'Jumping_boy_sprites_v102/Transparent PNG/Idle/frame-2.png');

        //Walking Assets
        this.load.image('Walk_001', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-1.png');
        this.load.image('Walk_002', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-2.png');
        this.load.image('Walk_003', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-3.png');
        this.load.image('Walk_004', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-4.png');
        this.load.image('Walk_005', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-5.png');
        this.load.image('Walk_006', 'Jumping_boy_sprites_v102/Transparent PNG/running/frame-6.png');

        // Background assets
        this.load.image('Background', 'craftpix-809414-cartoon-vertical-game-backgrounds/png/1.png');
    }

    DisplayLoadingMessege(){
        loadingText = this.add.text(180, 300, '0%', { fontSize: '18px', align:'center', fill: '#fff' });
        this.load.on('progress', function (value) {
            loadingText.setText(parseInt(value*100)+'%');
            loadingText.setOrigin(0.5);
        });
    }

    create(){
    	cursors = this.input.keyboard.createCursorKeys();
        //  A simple background for our game
        var background = this.add.image(180, 300, 'Background').setScale(0.35);
        var Logo = this.add.image(180, 275, 'Logo').setScale(0.5);
        this.createStartButton(180,350);
        background.setScrollFactor(0);
    }
}

class Score extends Menu{
    constructor(){
        super({ key:'Score', active:false});
    }

    create(){
    	cursors = this.input.keyboard.createCursorKeys();
        //  A simple background for our game
        var background = this.add.image(180, 300, 'Background').setScale(0.35);
        var Logo = this.add.image(180, 200, 'Logo').setScale(0.5);
        var final_score = score*10-time;
        if(final_score < 0) final_score = 0;
        scoreText = this.add.bitmapText(180, 260, 'myfont',final_score ,36);
        scoreText.setOrigin(0.5);
	    this.createStartButton(180, 375);
        this.createStars();
	    score = 0;
        background.setScrollFactor(0);
    }

    createStars(){
        // Maximum score of 50 is allowed
        if (score < 35) this.add.image(180,300,'Score0').setScale(0.25);
	    else if (score < 40) this.add.image(180,300,'Score1').setScale(0.25);
	    else if (score < 45) this.add.image(180,300,'Score2').setScale(0.25);
	    else this.add.image(180,300,'Score').setScale(0.25);
    }
}

class Play extends Phaser.Scene{
    constructor(){
        super({ key:'Play', active:false});
    }

    startClock(){
        this.clearClock();
        var self = this;
        clock = setInterval(function(){
            time++;
            self.tweens
            .add({
                targets: time_text,
                alpha:0,
                duration: 250,
                ease: 'Power2',
                yoyo:true
            }, self);
            
        }, 1000);

    };

    clearClock(){
        clearInterval(clock);
    };

    create(){
        //  Input Events
        cursors = this.input.keyboard.createCursorKeys();

        coin = this.sound.add('Coin',{loop:false});
        jump = this.sound.add('Jump',{loop:false});
        game_over = this.sound.add('GameOver',{loop:false});

        this.createPath();
        this.createBackground();
        this.createStaticGrassyPads();
	    this.createMovingGrassyPads();
        this.createBananas();
        this.createBirds();
        this.createBonuses();
        this.createTarzen();
        this.createScore();
	    this.createCamera();
		this.createVolume(320,570,0.05);
        this.createCompleteBar();
        this.createTime();

        // Declare Collision and OVerlaps
        this.physics.add.collider(tarzan, pads, this.touchPad.bind(this));
        this.physics.add.collider(tarzan, moving_pads, this.touchPad.bind(this));
        this.physics.add.overlap(tarzan, bananas, this.collideBanana.bind(this));
        this.physics.add.overlap(tarzan, bonus, this.powerOverlap);
        this.physics.add.collider(tarzan, birds, this.jumpOnBird.bind(this));
    };

    update(){
        this.updateTarzen();
	    this.updateBirds();
        this.updateMovingGrassyPads();
	    this.updateBackground();
        this.updateCompleteBar();
        this.updateTime();
    };
    
    createCamera(){
        this.cameras.main.setBounds(0,-20000, 300, 20600);
        this.cameras.main.startFollow(tarzan,1,1, 100,100);
    };

    createPath(){
        for (var i = 0; i < 200; i=i+1)
        {
            path[i]= {x: Phaser.Math.Between(50, 250), y:(475-i*100)};
        }
    };

    createTime(){
        time_sprite = this.add.sprite(310, 25, 'Time');
        time_sprite.setScale(0.125,0.125)﻿;
        time_sprite.setScrollFactor(0);
        time_text = this.add.text(305, 18, time, {fill : 'black'});
        time_text.setScrollFactor(0);
        time = 0;
        this.startClock();
    };

    updateTime(){
        time_text.text = time;
    };

    createCompleteBar(){
        var scrollbar = this.add.image(190, 25, 'ScrollBar').setScale(0.15);
        scrollbar.setScrollFactor(0);
        mini_tarzen = this.add.sprite(130, 25, 'Walk_001');
        mini_tarzen.setScrollFactor(0);
        mini_tarzen.setScale(0.050,0.050)﻿;
    };

    createStaticGrassyPads(){
        // Some pads to collect, 10 in total
        pads = this.physics.add.group({
	    allowGravity:false,
	    immovable:true,
	    enableBody:true
        });

        for (var i = 0; i < path.length; i=i+2)
        {
	        var padl = pads.create(path[i].x,path[i].y+50, 'Pad').setScale(0.1);
			padl.body.checkCollision.down = false;
    	    padl.body.checkCollision.left = false;
    	    padl.body.checkCollision.right = false;
            padl.body.friction.x = 1;
			
			if(path[i].x < 150){
			    var padr = pads.create(Phaser.Math.Between(path[i].x + 150, 250),path[i].y+50, 'Sharp_Pad').setScale(0.1);
			    padr.body.checkCollision.down = false;
    	        padr.body.checkCollision.left = false;
    	        padr.body.checkCollision.right = false;
                padr.body.friction.x = 0.5;
			}
			else{
			    var padr = pads.create(Phaser.Math.Between(50, path[i].x-150),path[i].y+50, 'Sharp_Pad').setScale(0.1);
			    padr.body.checkCollision.down = false;
    	        padr.body.checkCollision.left = false;
    	        padr.body.checkCollision.right = false;
                padr.body.friction.x = 0.5;			
			}
		
        }
    };

    createMovingGrassyPads(){
        // Some pads to collect, 10 in total
        moving_pads = this.physics.add.group({
	    allowGravity:false,
	    immovable:true,
	    enableBody:true
        });

        for (var i = 1; i < path.length; i=i+2)
        {
	        var pad = moving_pads.create(path[i].x,path[i].y+50, 'Pad').setScale(0.1);
 	        pad.body.checkCollision.down = false;
    	    pad.body.checkCollision.left = false;
    	    pad.body.checkCollision.right = false;
            pad.body.friction.x = 1;
	        pad.setVelocityX(50);
        }
    };
	
    createVolume(x,y,scale){
	    var Button = this.add.image(x, y, 'ButtonVolume').setScale(scale);
        var self = this;
		Button.setTexture('ButtonVolume_lock').setScale(scale);
	    Button
        .setInteractive({useHandCursor: true})
        .on('pointerover', () => {Button.setTexture('ButtonVolume_hover').setScale(scale);})
        .on('pointerout', () => {
		    if (volume == 1){ 
				Button.setTexture('ButtonVolume').setScale(scale);
			}
            else if (volume == 0){
			    Button.setTexture('ButtonVolume_lock').setScale(scale);
			}
		})
        .on('pointerdown', () => { 
		Button.setTexture('ButtonVolume_click').setScale(scale)
			if (volume == 1){ 
				volume = 0;
			}
			else if (volume == 0){ 
				volume = 1;
			}
		});
		Button.setScrollFactor(0);

    };
	
    createBirds(){
        this.anims.create({
            key: 'bird_flying',
            frames: [
                { key: 'Bird_0', frame: null },
                { key: 'Bird_1', frame: null },
                { key: 'Bird_2', frame: null },
                { key: 'Bird_3', frame: null }
            ],
            frameRate: 10,
            repeat: -1
        });

        // Some pads to collect, 10 in total
        birds = this.physics.add.group({
	    allowGravity:false,
	    immovable:true,
	    enableBody:true
        });


        for (var i = 0; i < path.length; i=i+1)
        {
	    if((i+2)%20 == 0) {
		var bird = birds.create(path[i].x,path[i].y+100, 'Bird_0').setScale(0.05);
		bird.anims.play('bird_flying', true);
		bird.setVelocityX(50);
            }
        }
    }

    createBananas(){
        //  Some bananas to collect, 10 in total
        bananas = this.physics.add.group({allowGravity:false,immovable:true,enableBody:true});
        for (var i = 0; i < path.length; i=i+1)
        {
	    if(i%4 ==0){ 
                var banana = bananas.create(path[i].x,path[i].y, 'Banana').setScale(0.05);
            }
            this.tweens
            .add({
                targets: banana,
                scale:0.1,
                duration: 1000,
                ease: 'Power2',
                repeat:-1,
                yoyo:true
            }, this);
        }
    }

    createScore(){
        //  The score
        var banana = this.add.image(25, 25, 'Banana').setScale(0.1);
        banana.setScrollFactor(0);
        scoreText = this.add.bitmapText(50, 10, 'myfont', score,24 ); 
        scoreText.setScrollFactor(0);
    }

    createBonuses(){
        //  Some bonus to collect, 10 in total
        bonus = this.physics.add.group({allowGravity:false,immovable:true,enableBody:true});
        for (var i = 0; i < path.length; i=i+1)
        {
            if((i+6)%20 == 0) var jump = bonus.create(path[i].x,path[i].y, 'Jump').setScale(0.1); 

        }
    }

    createTarzen(){
        // Create Tarzan
        this.anims.create({
            key: 'falling_down',
            frames: [
                { key: 'Falling_Down', frame: null },
            ],
            frameRate: 50
        });

        this.anims.create({
            key: 'jump_up',
            frames: [
                { key: 'Jump_Up', frame: null }
            ],
            frameRate: 50
        });

        this.anims.create({
            key: 'walk',
            frames: [
                { key: 'Walk_001', frame: null },
                { key: 'Walk_002', frame: null },
                { key: 'Walk_003', frame: null },
                { key: 'Walk_004', frame: null },
                { key: 'Walk_005', frame: null },
                { key: 'Walk_006', frame: null }
            ],
            frameRate: 10,
        });

        this.anims.create({
            key: 'idle',
            frames: [
                { key: 'Idle_000', frame: null },
                { key: 'Idle_001', frame: null }
            ],
            frameRate: 5
        });

        // Declare tarzan
        tarzan = this.physics.add.sprite(180, 450, 'Walk_001');
        tarzan.setScale(0.075,0.075)﻿;
        tarzan.setVelocityY(-750);
        tarzan.body.friction.x = 1;
    }

    createBackground(){
        //  A simple background for our game
        background = this.add.image(180, 300, 'Background').setScale(0.70);
        background.setScrollFactor(0);
    }

    updateBackground(){
	    background.setPosition((360-((180*tarzan.x)/180)), (50-((300*tarzan.y)/10000)));
    }


    flipLeft(object,speed){
        object.setVelocityX(-1*speed);
        object.setFlipX(true);
    }

    flipRight(object,speed){  
        object.setVelocityX(speed);
        object.setFlipX(false);
    }

    updateTarzen(){
        if ((cursors.up.isDown) && (tarzan.body.touching.down)) this.jumpPad(tarzan,current_pad);
		
		if ((tarzan.body.touching.down) && (current_pad.body.friction.x == 0.5)){
            this.gameOver();
		} 
        if(tarzan.body.velocity.y > 750){
            this.gameOver();
        }
        if (cursors.right.isDown){ 
            this.flipRight(tarzan,100);
	    if (tarzan.body.touching.down){
                tarzan.anims.play('walk', true);
            }
        }
        else if (cursors.left.isDown) {
            this.flipLeft(tarzan,100);
	    if (tarzan.body.touching.down){
                tarzan.anims.play('walk', true);
            }
        }
        else{
            tarzan.setVelocityX(0);
        }

        if (tarzan.x > 330) this.flipLeft(tarzan,200);
        else if (tarzan.x < 30) this.flipRight(tarzan,200);

        if (tarzan.body.velocity.y < 0) tarzan.anims.play('falling_down', true);
        if (tarzan.body.velocity.y > 0) tarzan.anims.play('jump_up', true);
        if ((tarzan.body.velocity.y == 0) && (tarzan.body.velocity.x == 0))tarzan.anims.play('idle', true);
    }

    updateBirds(){
        birds.children.each(function(bird) {  
            if (bird.x > 330) this.flipLeft(bird, 50);
            else if (bird.x < 30) this.flipRight(bird,50);
        }, this);
    }

    updateCompleteBar(){
        mini_tarzen.setX(-tarzan.y/20000*120 + 135);
    }

    updateMovingGrassyPads(){
        moving_pads.children.each(function(moving_pad) {  
            if (moving_pad.x > 300) this.flipLeft(moving_pad, 50);
            else if (moving_pad.x < 50) this.flipRight(moving_pad,50);
        }, this);
    }

    touchPad(tarzen,pad){
	    current_pad = pad;
    }

    jumpPad(tarzan,pad){
        if ((tarzan.body.touching.down) && (pad.body.touching.up)){
            this.tweens
            .add({
                targets: pad,
                alpha: 0,
                duration: 5000,
                ease: 'Power2',
	        onComplete:function(){
                    pad.disableBody(true, true);
	           }
            }, this);
            pad.setAccelerationY(500);
            tarzan.setVelocityY(-500);
        }
    }

    jumpOnBird(tarzan,bird){
        if ((tarzan.body.touching.down) && (bird.body.touching.up)){
            if (volume == 1) jump.play();
            this.tweens
            .add({
                targets: bird,
                alpha: 0,
                duration: 500,
                ease: 'Power2',
	        onComplete:function(){
                    bird.disableBody(true, true);
	        }
            }, this);
            bird.setAccelerationY(500);
            tarzan.setVelocityY(-1000);
        }
	   else{
            this.gameOver();
	   }
    }

    powerOverlap(tarzan, Bonus){
	    if(volume == 1) jump.play();
        Bonus.disableBody(true, true);
        tarzan.setVelocityY(-1000);  
    }


    collideBanana(tarzan, banana){
	var self = this;
        if(!banana.hasOverlapped){
            banana.hasOverlapped = true;
            self.tweens
            .add({
                targets: banana,
                alpha: 0,
                scale:0,
                duration: 250,
                ease: 'Power2',
	            onComplete:function(){
                    if (volume == 1) coin.play();
        	        // Declare tarzan
                    var point = self.physics.add.sprite(tarzan.x, tarzan.y-100, 'Point');
                    point.setScale(0.25,0.25)﻿;
		            banana.disableBody(true, true);
                    point.setVelocityY(-350);
		            self.tweens
                    .add({
                        targets: point,
                        alpha: 0,
                        scale:1,
                        duration:1000,
                        ease:'Power2',
                        onComplete:function(){
                            point.disableBody(true,true);
                        }
                    }, self);
		            score++;
                    scoreText.setText(score);
	            }
            }, self);
        }
    }

    gameOver(){
        if(volume != 0) game_over.play();
        this.scene.bringToTop('Score');
        this.scene.start('Score');
    }
}


var config = {
    type: Phaser.AUTO,
    width: 360,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 1000 },
            debug: false
        }
    },
    scene: [Start, Play, Score]
};

var game = new Phaser.Game(config);

</script>
</body>
</html>      
